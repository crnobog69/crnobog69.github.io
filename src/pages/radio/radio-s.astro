---
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import Layout from "../../layouts/Layout.astro";
---

<Layout>
    <Header />

    <main class="radio-main">
        <div class="radio-container">
            <header class="radio-header">
                <a href="/radio" class="back-link">← back to radio list</a>
                <h1>Radio S</h1>
                <p class="subtitle">streaming now</p>
            </header>

            <section class="radio-content">
                <div class="terminal-window">
                    <div class="terminal-header">
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                    </div>
                    <div class="terminal-body">
                        <div class="radio-player">
                            <div class="player-controls">
                                <button id="playBtn" class="control-btn"
                                    >▶ play</button
                                >
                                <button
                                    id="stopBtn"
                                    class="control-btn"
                                    disabled>■ stop</button
                                >
                                <span id="status" class="status">stopped</span>
                            </div>
                            <div class="volume-control">
                                <label for="volumeSlider" class="volume-label"
                                    >volume</label
                                >
                                <input
                                    type="range"
                                    id="volumeSlider"
                                    min="0"
                                    max="100"
                                    value="50"
                                    class="volume-slider"
                                />
                                <span id="volumeValue" class="volume-value"
                                    >50%</span
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <Footer />
        </div>
    </main>
</Layout>

<script>
    const audio = new Audio(
        "	https://5bc45691ca49f.streamlock.net/asmedia/radios/playlist.m3u8",
    );
    const playBtn = document.getElementById("playBtn") as HTMLButtonElement;
    const stopBtn = document.getElementById("stopBtn") as HTMLButtonElement;
    const status = document.getElementById("status") as HTMLSpanElement;
    const volumeSlider = document.getElementById(
        "volumeSlider",
    ) as HTMLInputElement;
    const volumeValue = document.getElementById(
        "volumeValue",
    ) as HTMLSpanElement;

    // Load saved volume or default to 50
    const savedVolume = localStorage.getItem("radioVolume") || "50";
    volumeSlider.value = savedVolume;
    volumeValue.textContent = `${savedVolume}%`;
    audio.volume = parseInt(savedVolume) / 100;

    playBtn.addEventListener("click", () => {
        audio.play();
        playBtn.disabled = true;
        stopBtn.disabled = false;
        status.textContent = "playing...";
    });

    stopBtn.addEventListener("click", () => {
        audio.pause();
        audio.currentTime = 0;
        playBtn.disabled = false;
        stopBtn.disabled = true;
        status.textContent = "stopped";
    });

    volumeSlider.addEventListener("input", (e) => {
        const target = e.target as HTMLInputElement;
        const volume = parseInt(target.value) / 100;
        audio.volume = volume;
        volumeValue.textContent = `${target.value}%`;
        localStorage.setItem("radioVolume", target.value);
    });
</script>

<style>
    .radio-main {
        min-height: 100vh;
        padding: 100px 20px 40px;
    }

    .radio-container {
        max-width: 600px;
        margin: 0 auto;
        width: 100%;
    }

    .radio-header {
        margin-bottom: 60px;
        text-align: center;
    }

    .back-link {
        color: var(--primary);
        text-decoration: none;
        opacity: 0.7;
        font-size: 0.9rem;
        display: inline-block;
        margin-bottom: 20px;
        transition: opacity 0.2s;
    }

    .back-link:hover {
        opacity: 1;
    }

    .radio-header h1 {
        font-size: 3rem;
        font-weight: 500;
        margin-bottom: 8px;
    }

    .radio-content {
        margin-bottom: 60px;
    }

    .terminal-window {
        border: 1px solid var(--primary);
        background: var(--bg-alt);
        width: 100rem;
        max-width: 100%;
    }

    .terminal-header {
        padding: 8px 12px;
        border-bottom: 1px solid var(--primary);
        display: flex;
        gap: 6px;
    }

    .terminal-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--primary);
        opacity: 0.3;
    }

    .terminal-body {
        padding: 20px;
        font-size: 0.9rem;
    }

    .player-controls {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }

    .control-btn {
        background: transparent;
        border: 1px solid var(--primary);
        color: var(--primary);
        padding: 8px 16px;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.85rem;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
        text-transform: lowercase;
    }

    .control-btn:hover:not(:disabled) {
        opacity: 1;
    }

    .control-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .status {
        opacity: 0.6;
        font-size: 0.85rem;
    }

    .volume-control {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .volume-label {
        font-size: 0.85rem;
        opacity: 0.7;
        text-transform: lowercase;
    }

    .volume-slider {
        flex: 1;
        min-width: 120px;
        height: 4px;
        background: var(--bg);
        border: 1px solid var(--primary);
        outline: none;
        opacity: 0.7;
        transition: opacity 0.2s;
        appearance: none;
        -webkit-appearance: none;
    }

    .volume-slider:hover {
        opacity: 1;
    }

    .volume-slider::-webkit-slider-thumb {
        appearance: none;
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        background: var(--primary);
        cursor: pointer;
        border: 1px solid var(--primary);
    }

    .volume-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        background: var(--primary);
        cursor: pointer;
        border: 1px solid var(--primary);
    }

    .volume-value {
        font-size: 0.85rem;
        opacity: 0.6;
        min-width: 40px;
    }

    footer {
        opacity: 0.4;
        font-size: 0.85rem;
        text-align: center;
        padding-top: 40px;
        border-top: 1px solid var(--primary);
    }

    @media (max-width: 768px) {
        .radio-main {
            padding: 80px 20px 40px;
        }

        .radio-container {
            padding: 0;
        }

        .radio-header h1 {
            font-size: 2rem;
        }

        .terminal-body {
            padding: 16px;
            font-size: 0.85rem;
        }

        .terminal-window {
            width: 100%;
        }

        .control-btn {
            font-size: 0.8rem;
            padding: 6px 12px;
        }

        .volume-control {
            width: 100%;
        }

        .volume-slider {
            min-width: 100px;
        }
    }
</style>
